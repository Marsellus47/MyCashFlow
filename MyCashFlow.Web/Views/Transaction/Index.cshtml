@model MyCashFlow.Web.ViewModels.Transaction.TransactionIndexViewModel

@{
    ViewBag.Title = Model.Title;
}

@section Scripts {
	<script>
		var model = {
			transactions: ko.observableArray()
		};

		function sendAjaxRequest(httpMethod, callback, url) {
			$.ajax("/api" + (url ? "/" + url : ""), {
				type: httpMethod, success: callback
			});
		}

		function getAllItems() {
			sendAjaxRequest("GET", function (data) {
				model.transactions.removeAll();
				for (var i = 0; i < data.length; i++) {
					model.reservations.push(data[i]);
				}
			});
		}

		function removeItem(item) {
			sendAjaxRequest("DELETE", function () {
				getAllItems();
			}, item.transactionId);
		}

		$(document).ready(function () {
			getAllItems();
			ko.applyBindings(model);
		});
	</script>
}

<div class="section panel panel-primary">
	<div class="panel-heading">@Model.Header</div>
	<div class="panel-body">
		<p>
			@Html.ActionLink(Model.Create, MVC.Transaction.ActionNames.Create, null, new { @class = "btn btn-primary" })
		</p>
		<table class="table table-hover table-striped table-condensed">
			<thead>
				<tr>
					<th>
						@Html.DisplayNameFor(model => model.Items[0].Date)
					</th>
					<th>
						@Html.DisplayNameFor(model => model.Items[0].Amount)
					</th>
					<th>
						@Html.DisplayNameFor(model => model.Items[0].TransactionType)
					</th>
					<th>
						@Html.DisplayNameFor(model => model.Items[0].PaymentMethod)
					</th>
					<th></th>
				</tr>
			</thead>

			@*<tbody>
				@foreach (var item in Model.Items)
				{
					<tr class="@(@item.Income ? "success" : "danger")">
						<td>
							@Html.DisplayFor(modelItem => item.Date)
						</td>
						<td>
							@Html.DisplayFor(modelItem => item.Amount)
						</td>
						<td>
							@Html.DisplayFor(modelItem => item.TransactionType)
						</td>
						<td>
							@Html.DisplayFor(modelItem => item.PaymentMethod)
						</td>
						<td>
							@Html.ActionLink(Model.Edit, MVC.Transaction.ActionNames.Edit, new { id = item.TransactionID }, new { @class = "btn btn-primary" })
							@Html.ActionLink(Model.Details, MVC.Transaction.ActionNames.Details, new { id = item.TransactionID }, new { @class = "btn btn-info" })
							@Html.ActionLink(Model.Delete, MVC.Transaction.ActionNames.Delete, new { id = item.TransactionID }, new { @class = "btn btn-danger" })
						</td>
					</tr>
				}
			</tbody>*@

			<tbody data-bind="foreach: model.transactions">
				<tr>
					<td data-bind="text: Date"></td>
					<td data-bind="text: Amount"></td>
					<td data-bind="text: TransactionType"></td>
					<td data-bind="text: PaymentMethod"></td>
					<td>
						<button class="btn btn-primary" data-bind="click: removeItem">@Model.Delete</button>
					</td>
				</tr>
			</tbody>
		</table>
	</div>
</div>